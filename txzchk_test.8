.TH txzchk_test 8 "18 October 2022" "txzchk_test" "IOCCC tools"
.SH NAME
txzchk_test.sh \- test suite for \fBtxzchk(1)\fP
.SH SYNOPSIS
\fBtxzchk_test.sh\fP [\-h] [\-V] [\-v level] [\-t txzchk] [\-T tar] [\-F fnamchk] [\-d txzchk_tree]
.SH DESCRIPTION
\fBtxzchk_test.sh\fP runs \fBtxzchk\fP in text file mode on pseudo\-tar listings to make sure that bad tarballs are flagged with issues and good tarballs are not.
For the bad files it checks that the issues reported are the same as expected.
The script enforces that bad files have an associated error file to compare with the errors reported by \fBtxzchk(1)\fP so that this can be done without a problem.
If an error file is missing it is an error.
Conversely if a good file has an error file it is also an error.
.SH OPTIONS
.TP
\fB\-h\fP
Show help and exit.
.TP
\fB\-V\fP
Print version and exit.
.TP
\fB\-v \fIlevel\fP\fP
Set verbosity level to \fIlevel\fP for the script.
.TP
\fB\-t \fItxzchk\fP\fP
Specify path to \fBtxzchk\fP to \fItxzchk\fP.
.TP
\fB\-T \fItar\fP\fP
Specify path to \fBtar\fP to \fItar\fP.
.TP
\fB\-F \fIfnamchk\fP\fP
Specify path to \fBfnamchk\fP to \fIfnamchk\fP.
\fBtxzchk\fP uses \fBfnamchk\fP to test if the tarball is validly named and if the files listed are in the correct directory.
.TP
\fB\-d \fItxzchk_tree\fP\fP
Specify path to the directory with the expected subdirectories \fIgood\fP and \fIbad\fP, each containing text files of good and bad pseudo\-tarballs, to \fItxzchk_tree\fP.
As already noted, the \fIbad\fP subdirectory also has error files to compare against the output of \fBtxzchk(1)\fP, in order to make sure that the failure is the correct failure.
.SH EXIT STATUS
.TP
0
all is well
.TQ
1
at least one test failed
.TQ
2
\-h and help string printed or \-V and version string printed
.TQ
3
command line error
.TQ
>= 10
internal error
.SH FILES
\fItest_txzchk\fP
.RS
Default directory of good and bad subdirectories each respectively with good and bad pseudo\-tarballs.
.RE
\fItxzchk_test.log\fP
.RS
The log file kept by \fBtxzchk_test.sh\fP.
It will be removed prior to each time the script is run to keep the state of the file consistent with the run.
.RE
.SH NOTES
.PP
\fBtxzchk\fP was written by \fBCody Boone Ferguson\fP after discussion with \fBLandon Curt Noll\fP (one of the IOCCC Judges) in support of IOCCCMOCK, IOCCC28 and beyond.
In order to test different tarballs and tar listing formats Cody added the text file mode early on to help in development.
That fact coupled with the fact there is the need to test that the tool works properly is what inspired him to create this script.
.PP
When a new bad test file is added one has to update the error files. This can be accomplished by running:
.nf
.RS
\fB
    for i in ./test_txzchk/bad/*.txt; do ./txzchk \-q \-v 0 \-w \-T \-E txt "${i}" 2>"${i}".err; done\fP
.RE
.fi
.PP
which is also documented in the readme for this script.
Please note that this will overwrite all of the error files so one has to be careful that the errors are actually correct: if one were to have an outdated version of \fBtxzchk(1)\fP or there's some other problem (for example, an unknown tar listing output that's not specifically being tested), for two examples, then one could inadvertently make the script think all is okay when it's not okay at all!
.PP
The script \fBioccc_test.sh\fP runs this script.
.SH BUGS
.PP
The error files for the files under the bad subdirectory are not flexible in content because the script checks for an exact match between the output of \fBtxzchk(1)\fP and the error files.
This is why the script will always pass to \fBtxzchk(1)\fP the options \fB\-w \-v 0 \-q\fP.
As such the verbose option to the script really is only for the script.
Perhaps error codes should be used instead but since \fBtxzchk(1)\fP is supposed to check all issues this would have to be done differently from the rest of the repo.
Additionally if this was done it would make it necessary to have only one issue in each test file which is not a good idea as it's easier to miss feathered tarballs by the simple fact that one has to be sure to have enough test files (there are a lot of checks that \fBtxzchk(1)\fP performs!).
.PP
Perhaps there should be more tests done with the exit code of \fBtxzchk(1)\fP but the script is pretty thorough otherwise.
It is hoped that this will make the script harder to break than it is to have feathers in tar but if you can break it please report an issue on the GitHub issues page.
See \fBtxzchk(1)\fP for more details on this.
.SH SEE ALSO
\fBtxzchk(1)\fP, \fBtxzchk_test(8)\fP, \fBfnamchk(1)\fP.
