.\" section 1 man page for run_flex.sh
.\"
.\" This man page was first written by Cody Boone Ferguson for the IOCCC
.\" in 2022.
.\"
.\" Humour impairment is not virtue nor is it a vice, it's just plain
.\" wrong: almost as wrong as JSON spec mis-features and C++ obfuscation! :-)
.\"
.\" "Share and Enjoy!"
.\"     --  Sirius Cybernetics Corporation Complaints Division, JSON spec department. :-)
.\"
.TH run_flex.sh 8 "26 January 2023" "run_flex.sh" "IOCCC tools"
.SH NAME
.B run_flex.sh
\- run
.B flex
to generate C code from a
.I *.l
file or use backup files if error
.SH SYNOPSIS
.B run_flex.sh
.RB [\| \-h \| ]
.RB [\| \-V \|]
.RB [\| \-v
.IR level \|]
.RB [\| \-o \|]
.RB [\| \-f
.IR flex \|]
.RB [\| \-g
.IR verge \|]
.RB [\| \-p
.IR prefix \|]
.RB [\| \-s
.IR sorry.h \|]
.RB [\| \-S]
.RB [\| \-F
.IR dir \|]
.RB [\| \-D
.IR dir \|]
.B \-\-
.RB [\|
.RI flex_flags \|]
.SH DESCRIPTION
\fBrun_flex.sh\fP attempts to find a recent enough version of
.B flex
(minimum version defined in \fIrun_flex.sh\fP) and use it to generate code from the \fBprefix.l\fP file.
The default prefix is \fIjparse\fP but this script can be used for other scanners as well.
If a recent enough version is not found or
.B flex
encounters an error (syntax error or anything else) and the \fB\-o\fP option is not specified, it attempts to use the backup files \fIprefix.ref.c\fP and \fIprefix.lex.ref.h\fP.
.SH OPTIONS
.TP
.B \-h
print help and exit.
.TP
.B \-V
print version and exit.
.TP
.BI \-v\  level
set verbosity level to
.I level\c
\&.
.TP
.B \-o
do
.B NOT
use backup files.
If
.B flex
cannot be used or fails to generate the files the script will fail.
.TP
.BI \-f\  flex
set
.B flex
basename to
.I flex\c
\&.
.TP
.BI \-g\  verge
set path to the \fBverge\fP tool to \fIverge\fP.
This is used to determine if the
.B flex
tool is recent enough.
.TP
.BI \-p\  prefix
set prefix of files to use to
.I prefix\c
\&.
The
.B flex
input file will be
.I prefix.l\c
\&.
If the
.B \-o
option was not used and
.B flex
cannot be used or fails then the backup files
.I prefix.ref.c
and
.I prefix.lex.ref.h
will be used.
.TP
.BI \-s\  sorry.h
set path of file to prepend to the C output to
.I sorry.h\c
\&.
.TP
.B \-S
suppress prepending apology to generated C output files.
.TP
.BI \-F\  flex_dir
add directory
.I flex_dir
to list to search for
.B flex\c
\&.
.B \-F
can be used more than once.
If not used the script looks at
.B $PATH\c
\&.
.TP
.BI \-D\  dir
set directory to find the flex source file.
Default is \fI.\fP.
.PP
The
.I flex_flags
are any optional flags to give to
.B flex
before the prefix.
.SH EXIT STATUS
.TP
0
.B flex
output files formed or backup files used instead
.TQ
1
.B flex
not found or too old and \fB\-o\fP used
.TQ
2
good
.B flex
found and ran but failed to form proper output files
.TQ
3
.B flex
input file missing or not readable: backup files had to be used
.TQ
4
backup files missing or are not readable
.TQ
5
failed to use backup files to form the
.B flex
C output files
.TQ
6
.I sorry.h
file missing/not readable or
.B verge
missing/not executable
.TQ
.TQ
7
\-h and help string printed or \-V and version string printed
.TQ
8
command line usage error
.TQ
>=10
internal error
.SH NOTES
.PP
The \fB\-o\fP option is mainly for maintainers of the \fBjparse\fP scanner and parser but it can be used to test if you have a recent enough version of \fBflex\fP.
The idea behind it is if
.B flex
fails it might indicate a syntax error which the authors of \fBjparse\fP would need to fix.
.PP
Beware that some make implementations have a default rule for \fI*.l\fP files so that if one were to in this repo do:
.nf
.RS
\fB
 touch foo.l
 make\fP
.fi
.RE
.PP
the file \fIfoo.c\fP would be overwritten and cause a compilation error.
This appears to be because foo is actually referenced in the Makefile as a target.
.SH BUGS
.PP
If you have any issues with the tool you can open an issue at
.br
\fI\<https://github.com/ioccc\-src/mkiocccentry/issues\>\fP.
.SH EXAMPLES
.PP
Run \fBrun_flex.sh\fP with default options, which should attempt to run
.B flex
on the \fIjparse.l\fP file:
.nf
.RS
\fB
 ./run_flex.sh\fP
.fi
.RE
.PP
Run \fBrun_flex.sh\fP but specify that the backup files are not to be used in case a recent enough version of
.B flex
cannot be found or fails for some reason.
.nf
.RS
\fB
 ./run_flex.sh \-o\fP
.fi
.RE
.PP
Try and run
.B flex
on the file \fIfoobar.l\fP and don't use the backup files:
.nf
.RS
\fB
 ./run_flex.sh \-o \-p foobar\fP
.fi
.RE
.PP
Try and run
.B flex
on the file \fIfoobar.l\fP with lex instead of
.B flex
and don't use the backup files:
.nf
.RS
\fB
 ./run_flex.sh \-o \-p foobar \-f lex\fP
.fi
.RE
.SH SEE ALSO
\fBrun_bison(1)\fP, \fBjparse(1)\fP and \fBchkentry(1)\fP
